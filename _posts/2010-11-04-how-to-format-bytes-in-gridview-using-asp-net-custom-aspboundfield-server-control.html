---
layout: post
status: publish
published: true
title: How To Format Bytes in GridView Using ASP.NET (Custom asp:BoundField Server
  Control)
author:
  display_name: Peter Kellner
  login: admin
  email: peter@peterkellner.net
  url: ''
author_login: admin
author_email: peter@peterkellner.net
wordpress_id: 1385
wordpress_url: https://peterkellner.net/2010/11/04/how-to-format-bytes-in-gridview-using-asp-net-custom-aspboundfield-server-control/
date: '2010-11-04 08:35:09 -0700'
date_gmt: '2010-11-04 15:35:09 -0700'
categories:
- ASP.NET 2.0
tags: []
---
<h3>&#160;</h3>
<h2>(AKA, how to not use templates to do a simple GridView Column Formatting) </h2>
<p>&#160;</p>
<p>This post is inspired by another post on did on <a href="/2006/05/24/how-to-set-a-date-format-in-gridview-using-aspnet-20using-htmlencode-property/">GridView date formatting</a> years ago.&#160; It’s still very popular.</p>
<p>If you are like me, you don’t like using <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.aspx">GridView</a> Templates because it makes you write ugly verbose code.&#160; In this post, I’ll show you how to do a quick customization of the <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.boundfield.aspx">BoundField</a> asp.net&#160; server control.&#160; That is, the one you typically see in GridView as follows:</p>
<p>&#160;</p>
<p><a href="/FilesForWebDownload/d5424563765f_7094/image.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/FilesForWebDownload/d5424563765f_7094/image_thumb.png" width="244" height="90" /></a></p>
<p>What we plan to do, is to create a custom control that looks like the following:</p>
<p><a href="/FilesForWebDownload/d5424563765f_7094/image_3.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/FilesForWebDownload/d5424563765f_7094/image_thumb_3.png" width="511" height="102" /></a></p>
<p>and will end up displaying data in a table that looks like the following:</p>
<p><a href="/FilesForWebDownload/d5424563765f_7094/image_4.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/FilesForWebDownload/d5424563765f_7094/image_thumb_4.png" width="447" height="208" /></a></p>
<p>  <!--more-->
<p>So, one approach could be to simply convert the second column into a template with GridView and build a function to call that converts the column from numbers like 267030000 to 267.3 MB.&#160; To do that, the code on the GridView will look like the following:</p>
<p><a href="/FilesForWebDownload/d5424563765f_7094/image_5.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/FilesForWebDownload/d5424563765f_7094/image_thumb_5.png" width="616" height="193" /></a></p>
<p>And, the code behind will be as follows:</p>
<p>&#160;</p>
<div id="codeSnippetWrapper">
<pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">namespace</span> GridViewExtendedBoundField<br />{<br />    <span style="color: #0000ff">public</span> <span style="color: #0000ff">partial</span> <span style="color: #0000ff">class</span> WebForm2 : System.Web.UI.Page<br />    {<br />        <span style="color: #0000ff">protected</span> <span style="color: #0000ff">void</span> Page_Load(<span style="color: #0000ff">object</span> sender, EventArgs e)<br />        {<br /><br />        }<br /><br />        <span style="color: #0000ff">protected</span> <span style="color: #0000ff">string</span> FormatToBytes(<span style="color: #0000ff">long</span> bytes)<br />        {<br />            <span style="color: #0000ff">return</span> FormatBytes(bytes);<br />        }<br /><br />        <span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> FormatBytes(<span style="color: #0000ff">long</span> bytes)<br />        {<br />            <span style="color: #0000ff">const</span> <span style="color: #0000ff">int</span> scale = 1024;<br />            var orders = <span style="color: #0000ff">new</span> <span style="color: #0000ff">string</span>[] { <span style="color: #006080">&quot;GB&quot;</span>, <span style="color: #006080">&quot;MB&quot;</span>, <span style="color: #006080">&quot;KB&quot;</span>, <span style="color: #006080">&quot;Bytes&quot;</span> };<br />            var max = (<span style="color: #0000ff">long</span>)Math.Pow(scale, orders.Length - 1);<br />            <span style="color: #0000ff">foreach</span> (<span style="color: #0000ff">string</span> order <span style="color: #0000ff">in</span> orders)<br />            {<br />                <span style="color: #0000ff">if</span> (bytes &gt; max)<br />                    <span style="color: #0000ff">return</span> <span style="color: #0000ff">string</span>.Format(<span style="color: #006080">&quot;{0:##.##} {1}&quot;</span>, <span style="color: #0000ff">decimal</span>.Divide(bytes, max), order);<br />                max /= scale;<br />            }<br />            <span style="color: #0000ff">return</span> <span style="color: #006080">&quot;0 Bytes&quot;</span>;<br />        }<br />    }<br />}</pre>
</div>
<div>(Code Copied from <a title="http://sharpertutorials.com/pretty-format-bytes-kb-mb-gb/" href="http://sharpertutorials.com/pretty-format-bytes-kb-mb-gb/">http://sharpertutorials.com/pretty-format-bytes-kb-mb-gb/</a>)</div>
<div>&#160;</div>
<div>This is OK for a one time use, but if you plan on doing this kind of thing a lot, I think a better way to do it is to override the BoundField control with a custom server control.&#160; Then, the code you write will look like the following and you will not need any code behind.</div>
<div>&#160;</div>
<div id="codeSnippetWrapper">
<pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="background-color: #ffff00">&lt;%@ Register Assembly=&quot;CustomControls&quot;  Namespace=&quot;BoundControls&quot; TagPrefix=&quot;cc1&quot; %&gt;</span><br />...<br /><span style="color: #0000ff">&lt;</span><span style="color: #800000">asp:GridView</span> <span style="color: #ff0000">ID</span><span style="color: #0000ff">=&quot;GridView1&quot;</span> <span style="color: #ff0000">runat</span><span style="color: #0000ff">=&quot;server&quot;</span> <span style="color: #ff0000">AutoGenerateColumns</span><span style="color: #0000ff">=&quot;False&quot;</span> <br />           <span style="color: #ff0000">DataKeyNames</span><span style="color: #0000ff">=&quot;Id,Bytes&quot;</span> <span style="color: #ff0000">DataSourceID</span><span style="color: #0000ff">=&quot;ObjectDataSource1&quot;</span><span style="color: #0000ff">&gt;</span><br />  <span style="color: #0000ff">&lt;</span><span style="color: #800000">Columns</span><span style="color: #0000ff">&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">asp:BoundField</span> <span style="color: #ff0000">DataField</span><span style="color: #0000ff">=&quot;Id&quot;</span> <span style="color: #ff0000">HeaderText</span><span style="color: #0000ff">=&quot;Id&quot;</span> <span style="color: #ff0000">ReadOnly</span><span style="color: #0000ff">=&quot;True&quot;</span> <br />       <span style="color: #ff0000">SortExpression</span><span style="color: #0000ff">=&quot;Id&quot;</span> <span style="color: #0000ff">/&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">cc1:BoundFieldBytesDisplay</span> <span style="color: #ff0000">DataField</span><span style="color: #0000ff">=&quot;Bytes&quot;</span> <span style="color: #ff0000">FormatAsFancyBytes</span><span style="color: #0000ff">=&quot;true&quot;</span>   <span style="color: #0000ff">&gt;</span><br />    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">cc1:BoundFieldBytesDisplay</span><span style="color: #0000ff">&gt;</span></pre>
<p></div>
<p>The actual custom control you have to include is simply in library reference by the Assembly CustomControls (where you can put other stuff like this).&#160; That code is as follows:</p>
<div id="codeSnippetWrapper">
<pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">using</span> System;<br /><span style="color: #0000ff">using</span> System.Web.UI.WebControls;<br /><br /><span style="color: #0000ff">namespace</span> BoundControls<br />{<br />    <span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> BoundFieldBytesDisplay : BoundField<br />    {<br />        <span style="color: #0000ff">public</span> <span style="color: #0000ff">bool</span> FormatAsFancyBytes<br />        {<br />            get<br />            {<br />                <span style="color: #0000ff">if</span> (ViewState[<span style="color: #006080">&quot;FormatAsFancyBytes&quot;</span>] == <span style="color: #0000ff">null</span>)<br />                {<br />                    <span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span>;<br />                }<br />                <span style="color: #0000ff">return</span> (<span style="color: #0000ff">bool</span>) ViewState[<span style="color: #006080">&quot;FormatAsFancyBytes&quot;</span>];<br />            }<br />            set { ViewState[<span style="color: #006080">&quot;FormatAsFancyBytes&quot;</span>] = <span style="color: #0000ff">value</span>; }<br />        }<br /><br />        <span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">string</span> FormatDataValue(<span style="color: #0000ff">object</span> dataValue, <span style="color: #0000ff">bool</span> encode)<br />        {<br />            <span style="color: #0000ff">if</span> (!FormatAsFancyBytes)<br />            {<br />                <span style="color: #0000ff">return</span> <span style="color: #0000ff">base</span>.FormatDataValue(dataValue, encode);<br />            }<br />            <span style="color: #0000ff">else</span><br />            {<br />                <span style="color: #0000ff">return</span> FormatBytes(Convert.ToInt64(dataValue));<br />            }<br />        }<br /><br />        <span style="color: #008000">/// &lt;summary&gt;</span><br />        <span style="color: #008000">/// http://sharpertutorials.com/pretty-format-bytes-kb-mb-gb/</span><br />        <span style="color: #008000">/// &lt;/summary&gt;</span><br />        <span style="color: #008000">/// &lt;param name=&quot;bytes&quot;&gt;&lt;/param&gt;</span><br />        <span style="color: #008000">/// &lt;returns&gt;&lt;/returns&gt;</span><br />        <span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> FormatBytes(<span style="color: #0000ff">long</span> bytes)<br />        {<br />            <span style="color: #0000ff">const</span> <span style="color: #0000ff">int</span> scale = 1024;<br />            var orders = <span style="color: #0000ff">new</span>[] {<span style="color: #006080">&quot;GB&quot;</span>, <span style="color: #006080">&quot;MB&quot;</span>, <span style="color: #006080">&quot;KB&quot;</span>, <span style="color: #006080">&quot;Bytes&quot;</span>};<br />            var max = (<span style="color: #0000ff">long</span>) Math.Pow(scale, orders.Length - 1);<br />            <span style="color: #0000ff">foreach</span> (<span style="color: #0000ff">string</span> order <span style="color: #0000ff">in</span> orders)<br />            {<br />                <span style="color: #0000ff">if</span> (bytes &gt; max)<br />                    <span style="color: #0000ff">return</span> <span style="color: #0000ff">string</span>.Format(<span style="color: #006080">&quot;{0:##.##} {1}&quot;</span>, <span style="color: #0000ff">decimal</span>.Divide(bytes, max), order);<br />                max /= scale;<br />            }<br />            <span style="color: #0000ff">return</span> <span style="color: #006080">&quot;0 Bytes&quot;</span>;<br />        }<br />    }<br />}</pre>
<p></div>
<p>That’s basically it!&#160; Notice that in the custom control, all we have done is defined a property named “FormatAsFancyBytes” so we can set that to true.&#160; Once that happens, we simply call the FormatBytes method and it does the job we expect. If we have “FormatAsFancyBytes” false, or left out, then this control will perform identically to a BoundField control because we are calling the base class.</p>
<p>Keep in mind, you can add all kinds of special properties now to this control to handle all sorts of formatting that might be common to your business.</p>
<p>Here is the sample project build with <a href="http://www.microsoft.com/visualstudio/en-us/products/2010-editions">Visual Studio 2010</a> that demonstrates the above code.</p>
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:8eb9d37f-1541-4f29-b6f4-1eea890d4876:be9f8e87-2126-42ee-8fb2-1686a3d99203" class="wlWriterEditableSmartContent">
<div>Visual Studio 2010 Solution   <a href="/FilesForWebDownload/d5424563765f_7094/GridViewExtendedBoundField.zip" target="_self">GridViewExtendedBoundField.zip</a></div></p>
</div>
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:8eb9d37f-1541-4f29-b6f4-1eea890d4876:26eb3413-52b5-42d8-b591-be12a5b10f39" class="wlWriterEditableSmartContent">
<div>Visual Studio 2010 Solution   <a href="/FilesForWebDownload/d5424563765f_7094/GridViewExtendedBoundField_3.zip" target="_self">GridViewExtendedBoundField.zip</a></div></p>
</div>
