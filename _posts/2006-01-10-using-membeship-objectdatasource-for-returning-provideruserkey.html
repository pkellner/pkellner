---
layout: post
status: publish
published: true
title: Using Membeship ObjectDataSource For Returning ProviderUserKey (ForeignKey
  Use)
author:
  display_name: Peter Kellner
  login: Peter Kellner
  email: pkellner99@gmail.com
  url: ''
author_login: Peter Kellner
author_email: pkellner99@gmail.com
excerpt: "<p>This article gives an example of how to modify the Object DataSource
  in the previous article (<a href=\"http://peterkellner.net/archives/2006/01/09/24/\">Microsoft
  ASP.NET 2.0 Member/Role Management with IIS<br />\r\nPart 1: Security and   Configuration
  Overview </a> ) to return a ProviderUserKey which can then be used as a foreign
  key into the developer's own data tables.\r\n</p><p></p>"
wordpress_id: 16
wordpress_url: http://peterkellner.net/archives/2006/01/10/26/
date: '2006-01-10 09:54:53 -0800'
date_gmt: '2006-01-10 16:54:53 -0800'
categories:
- ".Net 2.0"
- Membership
- ObjectDataSource
- ASP.NET 2.0
tags: []
---

<p>I was recently asked how to use the Membership Data Object to return the unique ProviderKey generated by the Membership object. This may be necessary if want to associate the membership data with an existing table. That is, add a foreign key &quot;ProviderUserKey&quot; to another table so you can track an existing user to your current database without getting involved in extending the base provider. You can of course extend the existing provider to include other fields, but in general, you probably are better off maintaining your own tables rather than extending the provider model. Peter Dawson does an excellent job of explaining and showing how to extend the Membership Provider in his article <a href="http://www.theserverside.net/articles/showarticle.tss?id=CreatingProfileProvider">Creating a Custom ASP.NET Provider. </a>(published on theserverside.net)</p>
<p> <!--more-->
<p>So, back to what needs to be done to use my Membership ObjectDataClass (Part 2: Implementation&quot; href=&quot;http://peterkellner.net/archives/2006/01/09/24/&quot; rel=bookmark&gt;Microsoft ASP.NET 2.0 Member/Role Management with IIS
<p>Part 2: Implementation</p>
<p> ). First thing is you need to add another insert method to the class. This method takes just a few parameters and returns as out parameters both the status of the insert as well as the providerUserKey as a string.</p>
<p> 
<pre class="csharpcode">
[DataObjectMethod(DataObjectMethodType.Insert, <span class="kwrd">false</span>)]
<span class="kwrd">static</span> <span class="kwrd">public</span> <span class="kwrd">void</span> Insert(<span class="kwrd">string</span> userName,
    <span class="kwrd">bool</span> isApproved,
    <span class="kwrd">string</span> email,
    <span class="kwrd">string</span> passwordQuestion,
    <span class="kwrd">string</span> password,
    <span class="kwrd">string</span> passwordAnswer,
    <span class="kwrd">out</span> MembershipCreateStatus membershipCreateStatus,
    <span class="kwrd">out</span> <span class="kwrd">string</span> providerIdKeyString)
{
    MembershipUser muNew = Membership.CreateUser(userName,
        password, email, passwordQuestion, passwordAnswer,
        isApproved,<span class="kwrd">out</span> membershipCreateStatus);
    <span class="kwrd">if</span> (membershipCreateStatus ==
        MembershipCreateStatus.Success)
    {
        providerIdKeyString = muNew.ProviderUserKey.ToString();
    }
    <span class="kwrd">else</span>
    {
        providerIdKeyString = <span class="kwrd">string</span>.Empty;  <span class="rem">// failed</span>
    }
    <span class="kwrd">return</span>;
}</pre>
<p></p>
<p class="style4">Figure 1 - The New Insert Method to be added to MembershipUserODS.cs</p>
<p>If you want to turn the Guid passed back into a native Guid type do the following. (this could be useful if you want to retrieve the current username as shown below.</p>
<p></p>
<pre class="csharpcode">
Guid myNewGuild = <span class="kwrd">new</span> Guid(providerIdKeyString);
MembershipUser myCurrentMembershipUser = Membership.GetUser(myNewGuild);
<span class="kwrd">string</span> memberName = myCurrentMembershipUser.UserName;</pre>
<p></p>
<p class="style4">Figure 2 - Example of converting created ProviderUseKey to Guid and retreiving username</p>
<p>Now that we have the new Insert Method defined the easiest thing to do is use it directly. Below is a complete aspx page that references the new method as well as a screen shot of what it looks like to add a new member. Notice that the status label is returning the providerUserKey.</p>
<p><img src="http://peterkellner.net/wp/wp-content/uploads/2006/01/returnkey1.jpg" /></p>
<p><img src="http://peterkellner.net/wp/wp-content/uploads/2006/01/returnkey2.jpg" /></p>
<p class="style4">Figure 3 - Examples of adding a new user with a valid password, and one without a valid password</p>
<p></p>
<pre class="csharpcode">
<span class="kwrd">&lt;</span> %@ Page Language="C#" <span class="asp">%&gt;</span>
<span class="kwrd">&lt;</span> !DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"<span class="kwrd">&gt;</span>
 
<span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
 
    <span class="kwrd">protected</span> <span class="kwrd">void</span> ButtonNewUser_Click(<span class="kwrd">object</span> sender, EventArgs e)
    {
        MembershipCreateStatus membershipCreateStatus;
        <span class="kwrd">string</span> providerIdKeyString = <span class="kwrd">string</span>.Empty;
        MembershipUtilities.MembershipUserODS.Insert(TextBoxUserName.Text,
            CheckboxApproval.Checked,
            TextBoxEmail.Text,
            TextBoxPasswordQuestion.Text,
            TextBoxPassword.Text,
            TextBoxPasswordAnswer.Text,
            <span class="kwrd">out</span> membershipCreateStatus,
            <span class="kwrd">out</span> providerIdKeyString
        );
        <span class="kwrd">if</span> (membershipCreateStatus == MembershipCreateStatus.Success)
        {
            LabelInsertMessage.Text = <span class="str">"New User Create Successfully.  Key: "</span> + providerIdKeyString;
        }
        <span class="kwrd">else</span>
        {
            LabelInsertMessage.Text = membershipCreateStatus.ToString();
        }
 
        <span class="kwrd">return</span>;
    }
<span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
 
<span class="kwrd">&lt;</span><span class="html">html</span> <span class="attr">xmlns</span><span class="kwrd">="http://www.w3.org/1999/xhtml"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">head</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">title</span><span class="kwrd">&gt;</span>Untitled Page<span class="kwrd">&lt;/</span><span class="html">title</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">head</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">body</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">form</span> <span class="attr">id</span><span class="kwrd">="form1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">div</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:P</span> <span class="attr">anel</span> <span class="attr">ID</span><span class="kwrd">="PanelCreateUser"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">BorderColor</span><span class="kwrd">="Black"</span> <span class="attr">BorderWidth</span><span class="kwrd">="1px"</span>
                <span class="attr">Height</span><span class="kwrd">="50px"</span> <span class="attr">Width</span><span class="kwrd">="125px"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">table</span> <span class="attr">cellpadding</span><span class="kwrd">="3"</span> <span class="attr">cellspacing</span><span class="kwrd">="3"</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span> <span class="attr">style</span><span class="kwrd">="height: 32px"</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:Label</span> <span class="attr">ID</span><span class="kwrd">="Label3"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">Text</span><span class="kwrd">="UserName"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span> <span class="attr">style</span><span class="kwrd">="height: 32px"</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:TextBox</span> <span class="attr">ID</span><span class="kwrd">="TextBoxUserName"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span> <span class="attr">style</span><span class="kwrd">="height: 32px"</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:Label</span> <span class="attr">ID</span><span class="kwrd">="Label4"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">Text</span><span class="kwrd">="Password"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span> <span class="attr">style</span><span class="kwrd">="height: 32px"</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:TextBox</span> <span class="attr">ID</span><span class="kwrd">="TextBoxPassword"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:Label</span> <span class="attr">ID</span><span class="kwrd">="Label5"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">Text</span><span class="kwrd">="PasswordQuestion"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:TextBox</span> <span class="attr">ID</span><span class="kwrd">="TextBoxPasswordQuestion"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:Label</span> <span class="attr">ID</span><span class="kwrd">="Label6"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">Text</span><span class="kwrd">="PasswordAnswer"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:TextBox</span> <span class="attr">ID</span><span class="kwrd">="TextBoxPasswordAnswer"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:Label</span> <span class="attr">ID</span><span class="kwrd">="Label2"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">Text</span><span class="kwrd">="Email"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:TextBox</span> <span class="attr">ID</span><span class="kwrd">="TextBoxEmail"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:Label</span> <span class="attr">ID</span><span class="kwrd">="Label9"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">Text</span><span class="kwrd">="Approved"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:CheckBox</span> <span class="attr">ID</span><span class="kwrd">="CheckboxApproval"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="kwrd">/&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">asp</span> <span class="attr">:Button</span> <span class="attr">ID</span><span class="kwrd">="ButtonNewUser"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">OnClick</span><span class="kwrd">="ButtonNewUser_Click"</span> <span class="attr">Text</span><span class="kwrd">="Create New User"</span> <span class="kwrd">/&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">table</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;&lt;</span><span class="html">asp</span> <span class="attr">:Label</span> <span class="attr">ID</span><span class="kwrd">="LabelInsertMessage"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">form</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">body</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">html</span><span class="kwrd">&gt;</span></pre>
<p></p>
<p class="style4">Figure 4 - complete aspx page excercising new insert method</p>
