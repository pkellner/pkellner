---
status: publish
published: true
pubDatetime: 2011-08-24T20:00:00.000Z
title: Getting ExtJS 4 Date Format To Behave Properly in Grid Panel with ASP.NET MVC3
author:
  display_name: Peter Kellner
  login: admin
  email: peter@peterkellner.net
  url: ''
author_login: admin
author_email: peter@peterkellner.net
wordpress_id: 1556
wordpress_url: https://peterkellner.net/2011/08/24/getting-extjs-4-date-format-to-behave-properly-in-grid-panel-with-asp-net-mvc3/
date: '2011-08-24 11:52:44 -0700'
date_gmt: '2011-08-24 18:52:44 -0700'
categories:
- C#
- Database
- ".NET 4.0"
- MVC3
- Sencha
- DateFormat
tags: []
---
<p>&#160;</p>
<h3>Introduction and Problem</h3>
<p>Converting Data Formats back and forth between browser and back end servers can be a little confusing.&#160; In my case, I have a simple <a href="http://www.sencha.com/">Sencha</a>&#160;<a href="http://www.sencha.com/products/extjs/">ExtJS 4.0</a> form that the user types a date into.&#160; That date gets passed through an <a href="http://www.w3schools.com/ajax/default.asp">ajax request</a> to the <a href="http://www.microsoft.com/en-us/default.aspx">Microsoft</a> <a href="http://www.asp.net/">asp.net</a> <a href="http://www.asp.net/mvc/mvc3">controller</a>, then that dates updates the <a href="http://en.wikipedia.org/wiki/Microsoft_SQL_Server">SqlServer</a> Database.&#160; When the Date is displayed on a Grid Panel, again, an ajax request is made that grabs the date from the controller, then formats it using the MS <a href="http://dev.sencha.com/deploy/ext-4.0.2a/docs/#/api/Ext.data.Field-cfg-dateFormat">dateFormat</a> from ExtJS and hopefully, the same date the user typed in gets re-displayed.</p>
<div>
<div class="peterkellnerpromo"><a href="/open-source-javascript-extjs-and-jquery/" target="_blank">If you have a problem like this involving ASP.NET or Sencha Tools (ExtJS, SenchaTouch), more information about our consulting services are <span>here.</span></a></div>
</div>
<p>So, let’s look at the details.</p>
<h3>Posting the Date To the Server (View From JavaScript)</h3>
<p>First, we need to define an ExtJS Model that has the date in it.&#160; That codes looks like this in my case.</p>
<p><!--more--></p>
<p>&#160;</p>
<div id="codeSnippetWrapper">
<pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet">Ext.define(<span style="color: #006080">'EvMgr.model.SponsorListJobListing'</span>, {<br />    extend: <span style="color: #006080">'Ext.data.Model'</span>,<br />    fields: [<br />        <span style="color: #006080">'Id'</span>,<br />        <span style="color: #006080">'SponsorListId'</span>,<br />        <span style="color: #006080">'JobName'</span>,<br />        <span style="color: #006080">'JobLocation'</span>,<br />        <span style="color: #006080">'JobURL'</span>,<br />        <span style="color: #006080">'JobBrief'</span>,<br />        <span style="color: #006080">'JobTagline'</span>,<br />        <span style="color: #006080">'JobButtonToolTip'</span>,<br />        { name: <span style="color: #006080">'EnteredDate'</span>, type: <span style="color: #006080">'date'</span>, dateFormat: <span style="color: #006080">'MS'</span> },<br />        <span style="color: #006080">'JobCompanyName'</span>,<br />        { name: <span style="color: #006080">'StartRunDate'</span>, type: <span style="color: #006080">'date'</span>, dateFormat: <span style="color: #006080">'MS'</span> },<br />        { name: <span style="color: #006080">'EndRunDate'</span>, type: <span style="color: #006080">'date'</span>, dateFormat: <span style="color: #006080">'MS'</span> },<br />        { name: <span style="color: #006080">'HideListing'</span>, type: <span style="color: #006080">'boolean'</span> },<br />        <span style="color: #006080">'Notes'</span><br />    ],<br />    idProperty: <span style="color: #006080">'Id'</span>,<br /><br />    proxy: {<br />        type: <span style="color: #006080">'ajax'</span>,<br />        api: {<br />            read: <span style="color: #006080">'SponsorListJobListing/Get'</span>,<br />            update: <span style="color: #006080">'SponsorListJobListing/Update'</span>,<br />            create: <span style="color: #006080">'SponsorListJobListing/Create'</span>,<br />            destroy: <span style="color: #006080">'SponsorListJobListing/Delete'</span><br />        },<br />        reader: {<br />            type: <span style="color: #006080">'json'</span>,<br />            root: <span style="color: #006080">'Data'</span>,<br />            successProperty: <span style="color: #006080">'success'</span><br />        }<br />    },<br /><br /><br />    belongsTo: <span style="color: #006080">'EvMgr.model.SponsorList'</span><br />});</pre>
<p></div>
<p>Notice the StartRunDate field has dateFormat of ‘MS”.</p>
<p>Now, we have an ExtJS Window that we use to collect the data from the user.&#160; The code is as follows:</p>
<div>
<pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet">Ext.define(<span style="color: #006080">'EvMgr.view.sponsorlist.ListJobListingsEdit'</span>, {<br />    extend: <span style="color: #006080">'Ext.window.Window'</span>,<br />    alias: <span style="color: #006080">'widget.sponsorlistjoblistingsedit'</span>,<br />    title: <span style="color: #006080">'Edit Job Listing'</span>,<br />    layout: <span style="color: #006080">'fit'</span>,<br />    width: 1000,<br />    autoShow: <span style="color: #0000ff">true</span>,<br /><br />    initComponent: <span style="color: #0000ff">function</span>() {<br /><br />        <span style="color: #0000ff">this</span>.items = [<br />            {<br />                xtype: <span style="color: #006080">'form'</span>,<br /><br />                items: [<br />                    {<br />                        xtype: <span style="color: #006080">'textfield'</span>,<br />                        name: <span style="color: #006080">'JobName'</span>,<br />                        fieldLabel: <span style="color: #006080">'JobName'</span>,<br />                        width: 850<br />                    },<br />                    {<br />                        xtype: <span style="color: #006080">'textfield'</span>,<br />                        name: <span style="color: #006080">'JobLocation'</span>,<br />                        fieldLabel: <span style="color: #006080">'JobLocation'</span>,<br />                        width: 850<br />                    },<br />                     {<br />                         xtype: <span style="color: #006080">'textfield'</span>,<br />                         name: <span style="color: #006080">'JobURL'</span>,<br />                         fieldLabel: <span style="color: #006080">'JobURL'</span>,<br />                         width: 850<br />                     },<br />                     {<br />                         xtype: <span style="color: #006080">'textfield'</span>,<br />                         name: <span style="color: #006080">'JobBrief'</span>,<br />                         fieldLabel: <span style="color: #006080">'JobBrief'</span>,<br />                         width: 850<br />                     }, {<br />                         xtype: <span style="color: #006080">'textfield'</span>,<br />                         name: <span style="color: #006080">'JobTagline'</span>,<br />                         fieldLabel: <span style="color: #006080">'JobTagline'</span>,<br />                         width: 850<br />                     },<br />                     {<br />                         xtype: <span style="color: #006080">'textfield'</span>,<br />                         name: <span style="color: #006080">'JobButtonToolTip'</span>,<br />                         fieldLabel: <span style="color: #006080">'JobButtonToolTip'</span>,<br />                         width: 850<br />                     },<br />                     {<br />                         xtype: <span style="color: #006080">'textfield'</span>,<br />                         name: <span style="color: #006080">'JobCompanyName'</span>,<br />                         fieldLabel: <span style="color: #006080">'JobCompanyName'</span>,<br />                         width: 850<br />                     },<br />                     {<br />                         xtype: <span style="color: #006080">'textfield'</span>,  <span style="color: #008000">// checkbox makesthe value not come back for some reason</span><br />                         name: <span style="color: #006080">'HideListing'</span>,<br />                         fieldLabel: <span style="color: #006080">'HideListing'</span>,<br />                         width: 850<br />                     },<br />                     {<br />                         xtype: <span style="color: #006080">'datefield'</span>,<br />                         name: <span style="color: #006080">'StartRunDate'</span>,<br />                         fieldLabel: <span style="color: #006080">'StartRunDate'</span>,<br />                         width: 850<br />                     },<br />                     {<br />                         xtype: <span style="color: #006080">'datefield'</span>,<br />                         name: <span style="color: #006080">'EndRunDate'</span>,<br />                         fieldLabel: <span style="color: #006080">'EndRunDate'</span>,<br />                         width: 850<br />                     },<br />                    {<br />                        xtype: <span style="color: #006080">'textfield'</span>,<br />                        name: <span style="color: #006080">'SponsorListId'</span>,<br />                        fieldLabel: <span style="color: #006080">'SponsorListId'</span>,<br />                        width: 850<br />                    }<br />                ]<br />            }<br />        ];<br /><br />        <span style="color: #0000ff">this</span>.buttons = [<br />            {<br />                text: <span style="color: #006080">'Save'</span>,<br />                action: <span style="color: #006080">'save'</span><br />            }, {<br />                text: <span style="color: #006080">'Cancel'</span>,<br />                scope: <span style="color: #0000ff">this</span>,<br />                handler: <span style="color: #0000ff">this</span>.close<br />            }<br />        ];<br /><br />        <span style="color: #0000ff">this</span>.callParent(arguments);<br />    }<br />});</pre>
</div>
<div>Notice we don’t have to mention the StartRunDate’s format because the model has that already.</div>
<div>&#160;</div>
<div>When we run the app and press the “save” button, the actual post that goes back to the asp.net MVC3 controller looks like the following (notice the screen shot of the app first, then what happens when the Save button is pressed)</div>
<div>&#160;</div>
<div><a href="/wp/wp-content/uploads/2011/08/image4.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/wp/wp-content/uploads/2011/08/image_thumb3.png" width="608" height="320" /></a></div>
<div>&#160;</div>
<div><a href="/wp/wp-content/uploads/2011/08/image5.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/wp/wp-content/uploads/2011/08/image_thumb4.png" width="466" height="395" /></a></div>
<div>&#160;</div>
<div>You can see that the date is passed back as Date(1313996400000).&#160; This is actually UTC time so we will need to make sure we check for that on the server.&#160; It’s always a good idea to store all dates on the server in UTC time anyhow.</div>
<div>&#160;</div>
<h3>Posting the Date To the Server (View From ASP.NET)</h3>
<div>&#160;</div>
<div>So let’s take a look at what is coming to the server.&#160; Remember that in the model, we defined what REST api is hit by a post from this model.&#160; In this case, it’s “update: 'SponsorListJobListing/Update',”.&#160; So, let’s debug into the C# (asp.net) side and see what is actually coming in.&#160; Here is what we see:</div>
<div>&#160;</div>
<div><a href="/wp/wp-content/uploads/2011/08/image6.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/wp/wp-content/uploads/2011/08/image_thumb5.png" width="624" height="324" /></a></div>
<div>&#160;</div>
<div>Notice that the date comes in very simply as midnight on 8/22/2011 (the date we put in).&#160; The tricky part is we need to store this date as UTC so that when we end it back, it can get converted back to local.&#160; To do this, in our repository class, we have code to convert to UTC as follows:</div>
<div>&#160;</div>
<div><a href="/wp/wp-content/uploads/2011/08/image7.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/wp/wp-content/uploads/2011/08/image_thumb6.png" width="594" height="444" /></a></div>
<div>&#160;</div>
<div>&#160;</div>
<div>Your repository will look different, but this is a good example.&#160; Now, notice the StartRunDate will be 8/22/2011 at 7AM.</div>
<div>&#160;</div>
<div><a href="/wp/wp-content/uploads/2011/08/image8.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/wp/wp-content/uploads/2011/08/image_thumb7.png" width="620" height="76" /></a></div>
<p>&#160;</p>
<p>I’m over simplifying a little because it’s calculating UTC based on the Servers time zone, not the browsers.&#160; It would be better to send the timezone of the browser also and then calculate UTC correctly in <a href="http://en.wikipedia.org/wiki/JavaScript">JavaScript</a>, but I just want to give you the idea here.&#160; In my case, I’m always running this app from California and my server is always inCalifornia so at least things stay consistent.&#160; I do realize I’m simplifying and you need to make sure you think this through.</p>
<p>&#160;</p>
<p>Now, when I query the server for the returned data using the same ExtJS data model, the data comes down as follows.&#160; In ASP.NET it looks like this:</p>
<p><a href="/wp/wp-content/uploads/2011/08/image9.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/wp/wp-content/uploads/2011/08/image_thumb8.png" width="244" height="191" /></a></p>
<p>Which is actually different than what was pushed up.&#160; It seems though that when ExtJS displays this, it converts it to local time.</p>
<p>Our browser Grid shows it like this (as we would expect)</p>
<p><a href="/wp/wp-content/uploads/2011/08/image10.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/wp/wp-content/uploads/2011/08/image_thumb9.png" width="156" height="112" /></a></p>
<p>Hope this helps!</p>
